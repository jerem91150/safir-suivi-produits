generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model Utilisateur {
  id        Int      @id @default(autoincrement())
  login     String   @unique
  password  String
  nom       String
  email     String?
  role      String   @default("LECTEUR")
  actif     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  fiches FicheSuivi[]

  @@map("utilisateurs")
}

model FicheSuivi {
  id          Int      @id @default(autoincrement())
  reference   String   @unique
  gamme       String
  modele      String
  titre       String
  description String?
  matricules  String?

  // Champs d'information
  fournisseur         String?
  sousEnsemble        String?
  organe              String?
  valideRdLe          DateTime?
  enFabricationDepuis DateTime?

  // Pièce de tôlerie
  nomPieceTolerie String?
  codeX3          String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  createurId Int
  createur   Utilisateur @relation(fields: [createurId], references: [id])

  piecesJointes    PieceJointe[]
  achatsTemporaires AchatTemporaire[]

  @@index([gamme])
  @@index([modele])
  @@index([codeX3])
  @@map("fiches_suivi")
}

// Achats temporaires (crises, ruptures, etc.)
model AchatTemporaire {
  id          Int      @id @default(autoincrement())
  designation String
  fournisseur String?
  quantite    Int?
  prixUnitaire Float?
  dateDebut   DateTime?
  dateFin     DateTime?
  motif       String?
  statut      String   @default("EN_COURS") // EN_COURS, TERMINE, ANNULE
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  ficheId Int
  fiche   FicheSuivi @relation(fields: [ficheId], references: [id], onDelete: Cascade)

  @@map("achats_temporaires")
}

model PieceJointe {
  id         Int      @id @default(autoincrement())
  nomFichier String
  chemin     String
  typeMime   String
  taille     Int
  createdAt  DateTime @default(now())

  ficheId Int
  fiche   FicheSuivi @relation(fields: [ficheId], references: [id], onDelete: Cascade)

  @@map("pieces_jointes")
}
